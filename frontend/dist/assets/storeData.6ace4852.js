import{a as Y}from"./vue-router.8af1d4ba.js";import{_ as Z,a as ee}from"./Pagination.43d00eac.js";import{_ as ae}from"./index.d673f650.js";import{t as te,K as le,P as ne,w as q,J as oe}from"./@element-plus.c3edeb41.js";import{E as d,a as F}from"./element-plus.45a4936c.js";import{a as se,r as ie,a7 as de,w as ce,ah as re,M as m,$ as ue,z as k,G as pe,U as n,u as t,H as C,O as s,I as O,P as fe,A as G,S as h}from"./@vue.2fe925ce.js";const x=v=>{let f=v.target;(f.nodeName=="I"||f.nodeName=="SPAN")&&(f=v.target.parentNode),f.blur()};const ge={class:"container"},he={class:"handle-box"},me=h("\u641C\u7D22 "),_e=h("\u6E05\u9664 "),ve=h(" \u6DFB \u52A0"),we=h(" \u5220 \u9664"),be=h(" \u7F16\u8F91 "),xe=h("\u5220\u9664 "),$e={class:"dialog-footer"},ye=h("\u53D6 \u6D88"),Se=h("\u6DFB \u52A0"),De=h("\u66F4 \u65B0"),Ne={props:{page:Object,query:Object,data:Object,pageTotal:Number,formData:Object,formRules:Object,getData:Function,apis:Object},emits:["emitIsDisabled","emitIsShowSearched"],setup(v,{expose:f,emit:$}){const g=v,b=se(),e=ie({searched:[],isShowSearched:!1,selectedList:[],showDialog:!1,addOrUpdate:!0,idx:"-1",reIndex:-1,isLoading:!0}),{page:i,query:c,data:w,pageTotal:y,formData:p,formRules:j}=de(g),H=Y();var E;ce(()=>H.path,(l,a)=>{_(),window.clearTimeout(E)}),re(()=>{c.value.id.length==0&&_(),y.value==0?E=setTimeout(function(){e.isLoading=!1},3e3):e.isLoading=!1,$("emitIsShowSearched",e.isShowSearched)});function S(){return i.value.pageNameEn=="course"||i.value.pageNameEn=="selectCourse"?"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F":"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F(\u4EE5\u53CA\u76F8\u5173\u8054\u7684\u6570\u636E)"}function I(l){x(l),d({message:"\u641C\u7D22\u4E2D...",grouping:!0,type:"success",duration:1e3}),g.apis.read_data(c.value.id).then(a=>{a.code==200?(e.isShowSearched=!0,e.searched.splice(0,1,a.data)):d.warning("\u7F16\u53F7\u4E0D\u5B58\u5728")}).catch(()=>{d.error("\u641C\u7D22\u6570\u636E\u5931\u8D25!")})}function B(l){x(l),_()}function T(l){l.length==0&&(e.selectedList=[]),l.forEach((a,o)=>{e.selectedList.splice(o,1,{index:o,id:a.id})})}function V(l){x(l);let a=S();F.confirm(a,"\u63D0\u793A",{confirmButtonText:"\u5220\u9664",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{e.selectedList.map(o=>{g.apis.delete_data(o.id).then(u=>{u.code===200?(d.success(`\u5220\u9664\u7F16\u53F7\u4E3A ${o.id} \u7684\u6570\u636E\u6210\u529F\uFF01`),w.value.splice(o.index,1),_(!0)):d.warning(`\u5220\u9664\u7F16\u53F7\u4E3A ${o.id} \u7684\u6570\u636E\u5931\u8D25\uFF01`)}).catch(()=>{d.error("\u5220\u9664\u6570\u636E\u5931\u8D25\uFF01")})})}).catch(()=>{})}function U(l){x(l),Object.keys(p.value).forEach(a=>{p.value[a]=""}),i.value.pageName=="\u9009\u8BFE"&&p.value.grade===""&&(p.value.grade=0),e.showDialog=e.addOrUpdate=!0,$("emitIsDisabled",!1)}function L(){e.showDialog=!1,e.addOrUpdate=!0,b.value.validate(l=>{l?g.apis.create_data(p.value).then(a=>{a.code==200?(d.success(`\u6210\u529F\u6DFB\u52A0\u7F16\u53F7\u4E3A ${a.data.id} \u7684${i.value.pageName}\u4FE1\u606F\uFF01`),w.value.push(a.data),_(!0)):d.warning(`${i.value.pageName}\u4FE1\u606F\u586B\u5199\u6709\u8BEF\uFF0C\u6DFB\u52A0\u5931\u8D25\uFF01`)}).catch(()=>{d.error(`\u6DFB\u52A0${i.value.pageName}\u4FE1\u606F\u5931\u8D25\uFF01`)}):d.warning(`${i.value.pageName}\u4FE1\u606F\u4E0D\u7B26\u5408\u6821\u9A8C\u89C4\u5219\uFF0C\u6DFB\u52A0\u5931\u8D25\uFF01`),b.value.resetFields()})}function P(l,a){Object.keys(p.value).forEach(o=>{p.value[o]=a[o]}),e.showDialog=!0,e.addOrUpdate=!1,e.idx=a.id,e.reIndex=l,$("emitIsDisabled",!0)}function R(){e.showDialog=e.addOrUpdate=!1,b.value.validate(l=>{l?g.apis.update_data(e.idx,p.value).then(a=>{d.success(`\u4FEE\u6539${i.value.pageName}ID\u4E3A ${e.idx} \u6210\u529F\uFF01`),Object.keys(a.data).forEach(o=>{w.value[e.reIndex][o]=a.data[o]}),c.value.id.length!=0&&(e.searched[0]=p.value,console.log("saveEdit--",e.searched[0])),g.getData()}).catch(()=>{d.error(`\u4FEE\u6539${i.value.pageName}\u4FE1\u606F\u5931\u8D25\uFF01`)}):d.warning(`\u586B\u5199${i.value.pageName}\u4E0D\u7B26\u5408\u6821\u9A8C\u89C4\u5219\uFF0C\u4FEE\u6539\u5931\u8D25\uFF01`)})}function z(l,a){let o=S();F.confirm(o,"\u63D0\u793A",{confirmButtonText:"\u5220\u9664",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{g.apis.delete_data(a.id).then(u=>{u.code===200?(d.success(`\u5220\u9664\u7F16\u53F7\u4E3A ${a.id} \u7684${i.value.pageName}\u4FE1\u606F\u6210\u529F\uFF01`),w.value.splice(l,1),_(!0)):d.warning(`\u5220\u9664\u7F16\u53F7\u4E3A ${a.id} \u7684${i.value.pageName}\u4FE1\u606F\u5931\u8D25\uFF01`)}).catch(()=>{d.error(`\u5220\u9664${i.value.pageName}\u4FE1\u606F\u5931\u8D25\uFF01`)})}).catch(()=>{})}function A(l){c.value.currentPage=l,g.getData(l)}function _(l=!1){c.value.id="",e.isShowSearched=!1,l&&g.getData()}return f({state:e,page:i,query:c,data:w,pageTotal:y,formData:p,formRules:j,cascadeDelete:S,handleSearch:I,handleRemove:B,handleSelectionChange:T,handleSelectedDelete:V,handleAdd:U,saveAdd:L,handleEdit:P,saveEdit:R,handleDelete:z,pageIndex:A,removeSearch:_}),(l,a)=>{const o=m("el-input"),u=m("el-button"),M=m("el-col"),J=m("el-row"),D=m("el-table-column"),K=m("el-table"),Q=m("el-form"),W=m("el-dialog"),X=ue("loading");return k(),pe("div",null,[n(Z,{"icon-name":t(i).iconName,"page-name":t(i).pageName},null,8,["icon-name","page-name"]),C("div",ge,[C("div",he,[n(J,null,{default:s(()=>[n(M,{span:16},{default:s(()=>[n(o,{modelValue:t(c).id,"onUpdate:modelValue":a[0]||(a[0]=r=>t(c).id=r),maxlength:"11",placeholder:"\u7F16\u53F7",class:"grid-content handle-input mr10"},null,8,["modelValue"]),O(l.$slots,"filter",{},void 0,!0),n(u,{type:"primary",icon:t(te),disabled:!/(^[1-9]\d*$)/.test(t(c).id),onClick:I},{default:s(()=>[me]),_:1},8,["icon","disabled"]),n(u,{type:"primary",icon:t(le),disabled:t(c).id.length==0,onClick:B},{default:s(()=>[_e]),_:1},8,["icon","disabled"])]),_:3}),n(M,{span:8},{default:s(()=>[n(u,{type:"primary",icon:t(ne),class:"grid-content float-right",onClick:U},{default:s(()=>[ve]),_:1},8,["icon"]),n(u,{type:"danger",icon:t(q),class:"grid-content float-right mr10",disabled:t(e).selectedList.length==0,onClick:V},{default:s(()=>[we]),_:1},8,["icon","disabled"])]),_:1})]),_:3})]),fe(n(K,{data:t(e).isShowSearched?t(e).searched:t(w),border:"",stripe:"",class:"table","max-height":"578","default-sort":{prop:"id",order:"ascending"},onSelectionChange:T,"element-loading-text":"\u62FC\u547D\u52A0\u8F7D\u4E2D..."},{default:s(()=>[n(D,{type:"selection",width:"80",align:"center"}),n(D,{label:"\u5E8F\u53F7",type:"index",width:"80",align:"center",fixed:"",index:r=>r+1+(t(c).currentPage-1)*t(c).pageSize},null,8,["index"]),O(l.$slots,"tableColumn",{},void 0,!0),n(D,{label:"\u64CD\u4F5C",width:"220",align:"center",fixed:"right"},{default:s(r=>[n(u,{type:"text",icon:t(oe),onClick:N=>P(r.$index,r.row)},{default:s(()=>[be]),_:2},1032,["icon","onClick"]),n(u,{type:"text",icon:t(q),class:"red",onClick:N=>z(r.$index,r.row)},{default:s(()=>[xe]),_:2},1032,["icon","onClick"])]),_:1})]),_:3},8,["data"]),[[X,t(e).isLoading]]),n(ee,{"page-size":t(c).pageSize,"page-total":t(y),"current-page":t(c).currentPage,disabled:!t(e).isShowSearched,onPageIndex:A},null,8,["page-size","page-total","current-page","disabled"])]),n(W,{title:`${t(e).addOrUpdate?"\u6DFB\u52A0\u4FE1\u606F":"\u7F16\u8F91\u4FE1\u606F"}`,modelValue:t(e).showDialog,"onUpdate:modelValue":a[2]||(a[2]=r=>t(e).showDialog=r),width:"30%"},{footer:s(()=>[C("span",$e,[n(u,{onClick:a[1]||(a[1]=r=>t(e).showDialog=!1)},{default:s(()=>[ye]),_:1}),t(e).addOrUpdate?(k(),G(u,{key:0,type:"primary",onClick:L},{default:s(()=>[Se]),_:1})):(k(),G(u,{key:1,type:"primary",onClick:R},{default:s(()=>[De]),_:1}))])]),default:s(()=>[n(Q,{"status-icon":"","label-width":"100px",ref:(r,N)=>{N.formRef=r,b.value=r},model:t(p),rules:t(j)},{default:s(()=>[O(l.$slots,"showDialog",{},void 0,!0)]),_:3},8,["model","rules"])]),_:3},8,["title","modelValue"])])}}};var Be=ae(Ne,[["__scopeId","data-v-5ed4d062"]]);const Te=v=>v.map(f=>({id:f.id,name:f.name}));export{Be as B,Te as s};
