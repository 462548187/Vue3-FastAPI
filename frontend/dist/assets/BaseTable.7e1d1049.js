import{a as K}from"./vue-router.8af1d4ba.js";import{_ as Q,a as W}from"./Pagination.abd1a0e9.js";import{_ as X}from"./index.573e0148.js";import{t as Y,K as Z,P as ee,w as R,J as ae}from"./@element-plus.c3edeb41.js";import{E as s,a as L}from"./element-plus.45a4936c.js";import{a as te,r as le,a7 as oe,w as ne,ah as de,M as _,$ as se,z as D,G as ie,U as o,u as t,H as N,O as d,I as k,P as ce,A,S as f}from"./@vue.2fe925ce.js";const x=b=>{let v=b.target;(v.nodeName=="I"||v.nodeName=="SPAN")&&(v=b.target.parentNode),v.blur()};const re={class:"container"},ue={class:"handle-box"},pe=f("\u641C\u7D22"),ge=f("\u6E05\u9664 "),fe=f(" \u6DFB \u52A0"),he=f(" \u5220 \u9664"),_e=f(" \u7F16\u8F91 "),me=f("\u5220\u9664 "),ve={class:"dialog-footer"},be=f("\u53D6 \u6D88"),we=f("\u6DFB \u52A0"),xe=f("\u66F4 \u65B0"),Se={props:{page:Object,query:Object,data:Object,form:Object,getData:Function,apis:Object},emits:["emitIsDisabled","emitIsShowSearched"],setup(b,{expose:v,emit:S}){const p=b,w=te(),a=le({searched:[],isShowSearched:!1,selectedList:[],showDialog:!1,addOrUpdate:!0,pageTotal:0,idx:"-1",reIndex:-1}),{page:i,query:n,data:h,form:c}=oe(p),M=K();ne(()=>M.path,(l,e)=>{console.log(l,e),m()}),de(()=>{n.value.id.length==0&&m(),a.pageTotal=h.value.length||n.value.pageSize,S("emitIsShowSearched",a.isShowSearched)});function C(l){x(l),s({message:"\u641C\u7D22\u4E2D...",grouping:!0,type:"success",duration:1e3}),p.apis.read_datas(n.value.id).then(e=>{e.code==200?(a.isShowSearched=!0,a.searched.splice(0,1,e.data),console.log("\u88AB\u641C\u7D22\u7684\u6570\u636E--",e.data)):s.warning("\u7F16\u53F7\u4E0D\u5B58\u5728")}).catch(()=>{s.error("\u641C\u7D22\u6570\u636E\u5931\u8D25!")})}function O(l){x(l),m()}function j(l){l.length==0&&(a.selectedList=[]),l.forEach((e,r)=>{a.selectedList.splice(r,1,{index:r,id:e.id})})}function I(l){x(l),L.confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F","\u63D0\u793A",{confirmButtonText:"\u5220\u9664",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{a.selectedList.map(e=>{p.apis.delete_data(e.id).then(r=>{r.code===200?(s.success(`\u5220\u9664\u7F16\u53F7\u4E3A ${e.id} \u7684\u6570\u636E\u6210\u529F\uFF01`),h.value.splice(e.index,1),m(!0)):s.warning(`\u5220\u9664\u7F16\u53F7\u4E3A ${e.id} \u7684\u6570\u636E\u5931\u8D25\uFF01`)}).catch(()=>{s.error("\u5220\u9664\u6570\u636E\u5931\u8D25\uFF01")})})}).catch(()=>{})}function E(l){x(l),Object.keys(c.value.data).forEach(e=>c.value.data[e]=""),a.showDialog=a.addOrUpdate=!0,S("emitIsDisabled",!1)}function B(){a.showDialog=!1,a.addOrUpdate=!0,w.value.validate(l=>{i.value.pageName=="\u9009\u8BFE"&&c.value.data.grade===""&&(c.value.data.grade=0),l?p.apis.create_data(c.value.data).then(e=>{e.code==200?(s.success(`\u6210\u529F\u6DFB\u52A0\u7F16\u53F7\u4E3A ${e.data.id} \u7684${i.value.pageName}\u4FE1\u606F\uFF01`),h.value.push(e.data),m(!0)):s.warning(`${i.value.pageName}\u4FE1\u606F\u586B\u5199\u6709\u8BEF\uFF0C\u6DFB\u52A0\u5931\u8D25\uFF01`)}).catch(()=>{s.error(`\u6DFB\u52A0${i.value.pageName}\u4FE1\u606F\u5931\u8D25\uFF01`)}):s.warning(`${i.value.pageName}\u4FE1\u606F\u4E0D\u7B26\u5408\u6821\u9A8C\u89C4\u5219\uFF0C\u6DFB\u52A0\u5931\u8D25\uFF01`),w.value.resetFields()})}function P(l,e){Object.keys(c.value.data).forEach(r=>{c.value.data[r]=e[r]}),a.showDialog=!0,a.addOrUpdate=!1,a.idx=e.id,a.reIndex=l,S("emitIsDisabled",!0)}function T(){a.showDialog=a.addOrUpdate=!1,i.value.pageName=="\u9009\u8BFE"&&c.value.data.grade===""&&(c.value.data.grade=0),w.value.validate(l=>{l?p.apis.update_data(a.idx,c.value.data).then(e=>{s.success(`\u4FEE\u6539${i.value.pageName}ID\u4E3A ${a.idx} \u6210\u529F\uFF01`),Object.keys(e.data).forEach(r=>{h.value[a.reIndex][r]=e.data[r]}),n.value.id.length!=0&&(a.searched[0]=c.value.data,console.log("saveEdit--",a.searched[0])),p.getData()}).catch(()=>{s.error(`\u4FEE\u6539${i.value.pageName}\u4FE1\u606F\u5931\u8D25\uFF01`)}):s.warning(`\u586B\u5199${i.value.pageName}\u4E0D\u7B26\u5408\u6821\u9A8C\u89C4\u5219\uFF0C\u4FEE\u6539\u5931\u8D25\uFF01`)})}function U(l,e){L.confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F","\u63D0\u793A",{confirmButtonText:"\u5220\u9664",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{p.apis.delete_data(e.id).then(r=>{r.code===200?(s.success(`\u5220\u9664\u7F16\u53F7\u4E3A ${e.id} \u7684${i.value.pageName}\u4FE1\u606F\u6210\u529F\uFF01`),h.value.splice(l,1),m(!0)):s.warning(`\u5220\u9664\u7F16\u53F7\u4E3A ${e.id} \u7684${i.value.pageName}\u4FE1\u606F\u5931\u8D25\uFF01`)}).catch(()=>{s.error(`\u5220\u9664${i.value.pageName}\u4FE1\u606F\u5931\u8D25\uFF01`)})}).catch(()=>{})}function V(l){n.value.currentPage=l,p.getData()}function m(l=!1){n.value.id="",a.isShowSearched=!1,l&&p.getData()}return v({state:a,page:i,query:n,data:h,form:c,handleSearch:C,handleRemove:O,handleSelectionChange:j,handleSelectedDelete:I,handleAdd:E,saveAdd:B,handleEdit:P,saveEdit:T,handleDelete:U,pageIndex:V,removeSearch:m}),(l,e)=>{const r=_("el-input"),g=_("el-button"),z=_("el-col"),q=_("el-row"),$=_("el-table-column"),F=_("el-table"),G=_("el-form"),H=_("el-dialog"),J=se("loading");return D(),ie("div",null,[o(Q,{"icon-name":t(i).iconName,"page-name":t(i).pageName},null,8,["icon-name","page-name"]),N("div",re,[N("div",ue,[o(q,null,{default:d(()=>[o(z,{span:16},{default:d(()=>[o(r,{modelValue:t(n).id,"onUpdate:modelValue":e[0]||(e[0]=u=>t(n).id=u),maxlength:"11",placeholder:"\u7F16\u53F7",class:"grid-content handle-input mr10"},null,8,["modelValue"]),k(l.$slots,"filter",{},void 0,!0),o(g,{type:"primary",icon:t(Y),disabled:!/(^[1-9]\d*$)/.test(t(n).id),onClick:C},{default:d(()=>[pe]),_:1},8,["icon","disabled"]),o(g,{type:"primary",icon:t(Z),disabled:t(n).id.length==0,onClick:O},{default:d(()=>[ge]),_:1},8,["icon","disabled"])]),_:3}),o(z,{span:8},{default:d(()=>[o(g,{type:"primary",icon:t(ee),class:"grid-content float-right",onClick:E},{default:d(()=>[fe]),_:1},8,["icon"]),o(g,{type:"danger",icon:t(R),class:"grid-content float-right mr10",disabled:t(a).selectedList.length==0,onClick:I},{default:d(()=>[he]),_:1},8,["icon","disabled"])]),_:1})]),_:3})]),ce(o(F,{data:t(a).isShowSearched?t(a).searched:t(h).slice((t(n).currentPage-1)*t(n).pageSize,t(n).currentPage*t(n).pageSize),border:"",stripe:"",class:"table","max-height":"578","default-sort":{prop:"id",order:"ascending"},onSelectionChange:j,"element-loading-text":"\u62FC\u547D\u52A0\u8F7D\u4E2D..."},{default:d(()=>[o($,{type:"selection",width:"80",align:"center"}),o($,{label:"\u5E8F\u53F7",type:"index",width:"80",align:"center",fixed:"",index:u=>u+1+(t(n).currentPage-1)*t(n).pageSize},null,8,["index"]),k(l.$slots,"tableColumn",{},void 0,!0),o($,{label:"\u64CD\u4F5C",width:"220",align:"center",fixed:"right"},{default:d(u=>[o(g,{type:"text",icon:t(ae),onClick:y=>P(u.$index,u.row)},{default:d(()=>[_e]),_:2},1032,["icon","onClick"]),o(g,{type:"text",icon:t(R),class:"red",onClick:y=>U(u.$index,u.row)},{default:d(()=>[me]),_:2},1032,["icon","onClick"])]),_:1})]),_:3},8,["data"]),[[J,t(h)==""]]),o(W,{"page-size":t(n).pageSize,"page-total":t(a).pageTotal,disabled:t(a).isShowSearched,onPageIndex:V},null,8,["page-size","page-total","disabled"])]),o(H,{title:`${t(a).addOrUpdate?"\u6DFB\u52A0\u4FE1\u606F":"\u7F16\u8F91\u4FE1\u606F"}`,modelValue:t(a).showDialog,"onUpdate:modelValue":e[2]||(e[2]=u=>t(a).showDialog=u),width:"30%"},{footer:d(()=>[N("span",ve,[o(g,{onClick:e[1]||(e[1]=u=>t(a).showDialog=!1)},{default:d(()=>[be]),_:1}),t(a).addOrUpdate?(D(),A(g,{key:0,type:"primary",onClick:B},{default:d(()=>[we]),_:1})):(D(),A(g,{key:1,type:"primary",onClick:T},{default:d(()=>[xe]),_:1}))])]),default:d(()=>[o(G,{"status-icon":"","label-width":"100px",ref:(u,y)=>{y.formRef=u,w.value=u},model:t(c).data,rules:t(c).rules},{default:d(()=>[k(l.$slots,"showDialog",{},void 0,!0)]),_:3},8,["model","rules"])]),_:3},8,["title","modelValue"])])}}};var Oe=X(Se,[["__scopeId","data-v-1a996afd"]]);export{Oe as B};
